<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Branding Scraper</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background: #fafafa;
      position: relative;
      overflow-x: hidden;
    }

    input, button {
      padding: 10px;
      font-size: 16px;
    }

    .result {
      margin-top: 30px;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
    }

    .color-swatch {
      display: inline-block;
      width: 30px;
      height: 30px;
      margin: 3px;
      border: 1px solid #ccc;
    }

    /* ===== Animated Modal Styles ===== */
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .modal {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      width: 380px;
      max-width: 90%;
      text-align: center;
      padding: 32px 24px;
      position: relative;
      animation: slideUp 0.5s ease forwards;
    }

    .modal h2 {
      font-weight: 500;
      font-size: 18px;
      color: #333;
      margin-bottom: 24px;
    }

    .sparkle {
      font-size: 36px;
      display: inline-block;
      animation: bounce 1.5s ease infinite;
    }

    .steps {
      margin-top: 20px;
      text-align: left;
    }

    .step {
      background: #f0f8f4;
      border-radius: 8px;
      padding: 10px 12px;
      margin: 8px 0;
      display: flex;
      align-items: center;
      opacity: 0.4;
      transition: 0.4s;
    }

    .step.active {
      opacity: 1;
      background: #e8f7ed;
    }

    .check {
      width: 22px;
      height: 22px;
      border: 2px solid #69c27d;
      border-radius: 50%;
      margin-right: 10px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .check::after {
      content: '';
      position: absolute;
      width: 6px;
      height: 12px;
      border-right: 2px solid #69c27d;
      border-bottom: 2px solid #69c27d;
      transform: rotate(45deg) scale(0);
      transition: transform 0.3s ease;
    }

    .step.done .check::after {
      transform: rotate(45deg) scale(1);
    }

    .step p {
      margin: 0;
      color: #333;
      font-size: 14px;
      font-weight: 500;
    }

    .step span {
      display: block;
      font-size: 12px;
      color: #777;
    }

    .footer-text {
      margin-top: 20px;
      font-size: 13px;
      color: #777;
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    /* ===== Final Frame (Frame_0013) ===== */
    .final-screen {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #f9fafb;
      z-index: 10000;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      animation: fadeIn 0.6s ease forwards;
    }

    .final-header {
      position: absolute;
      top: 20px;
      right: 40px;
    }

    .final-header button {
      background: #007bff;
      border: none;
      color: white;
      font-size: 15px;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
    }

    .options {
      display: flex;
      gap: 20px;
      margin-top: 80px;
    }

    .option-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      padding: 30px 50px;
      text-align: center;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .option-card:hover {
      border-color: #007bff;
      transform: translateY(-4px);
    }

    .option-card.selected {
      border-color: #28a745;
      box-shadow: 0 0 10px rgba(40,167,69,0.3);
    }

    .option-card h3 {
      margin: 0 0 10px;
      color: #333;
    }

    .option-card p {
      margin: 0;
      color: #777;
      font-size: 14px;
    }
    .input-wrap {
        max-width: 800px;
        border-radius: 12px;
        background: #FFF;
        box-shadow: 0 0 8px 0 rgba(0, 0, 0, 0.10);
        margin-left: 56px;
    }
    .main-content {
        display: none;
        width: 100%;
    }
    .input-wrap-child {
        width: 100%;
        padding: 20px;
    }
    .input-box {
      width: 100%;
      border: none;
      outline: none;
      resize: none;
      height: 88px;
      color: #4D4D4D;
      overflow-y: hidden;
      font-family: Roboto;
      font-size: 16px;
      font-style: normal;
      font-weight: 400;
      line-height: normal;
      padding: 5px;
      max-width: 568px;
    }
    .input-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 95%;
    }
    .attach-button-container {
        position: relative;
        display: inline-block;
    }
    .attach-button {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        border: 1px solid #3B5998;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .attach-menu {
        position: absolute;
        top: 52px;
        left: 0;
        background: #FFF;
        border-radius: 8px;
        border: 0.5px solid #CCC;
        box-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.10);
        width: 205px;
        /* min-width: 200px; */
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.2s 
    ease;
        z-index: 1000;
    }
    .menu-option-wrap {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .menu-option {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .submit-btn {
        padding: 8px 16px;
        cursor: pointer;
        border: none;
        background-color: #1870D5;
        display: flex;
        border-radius: 50px;
        color: #FFFFFF;
        display: flex;
        gap: 10px;
        align-items: center;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <h1>üîç Website Branding Scraper</h1>

  <form id="scrapeForm">
    <input type="text" id="domain" name="domain" placeholder="Enter domain (e.g. https://www.airbnb.co.in)" size="50" required>
    <button type="submit">Analyze</button>
  </form>

  <div id="result" class="result" style="display:none;"></div>

  <!-- Animated Modal -->
  <div class="overlay" id="loadingModal">
    <div class="modal">
      <h2>‚ú® ProProfs AI is fetching details from your website</h2>
      <div class="sparkle">üòä</div>
      <div class="steps">
        <div class="step"><div class="check"></div><div><p>Thinking About Your Brand Style</p><span>Detecting your logo and brand colors</span></div></div>
        <div class="step"><div class="check"></div><div><p>Understanding the Content</p><span>Scanning your site to understand your content</span></div></div>
        <div class="step"><div class="check"></div><div><p>Designing Your Knowledge Base</p><span>Adapting visuals to match your Knowledge Base</span></div></div>
        <div class="step"><div class="check"></div><div><p>Outlining the Article</p><span>Preparing structure for AI generation</span></div></div>
      </div>
      <div class="footer-text">Sit back and relax, this will be quick and easy</div>
    </div>
  </div>

  <!-- Final Frame 0013 -->
  <div class="final-screen" id="finalScreen">
    <div class="final-header">
      <button id="saveBtn">üíæ Save</button>
    </div>
    <h2>Choose Visibility</h2>
    <div class="options">
      <div class="option-card" id="publicOption">
        <h3>üåê Public</h3>
        <p>Visible to everyone</p>
      </div>
      <div class="option-card" id="privateOption">
        <h3>üîí Private</h3>
        <p>Visible only to you or your team</p>
      </div>
    </div>
  </div>

  <div class="main-content" id="promptWindow">
    <div class="input-wrap">
        <div class="input-wrap-child">

            <textarea id="courseInput" aria-label="idea input" class="input-box" placeholder="Create a knowledge base for customer support about‚Ä¶"></textarea>
            <div class="text-display" id="textDisplay"></div>
            <div id="filedetails" class="input-box" style="display: none;"></div>
            <div class="input-actions">

                <div class="attach-button-container">
                    <div class="attach-button" id="attachBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none">
                            <path d="M6 2.5V9.5" stroke="#3B5998" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M2.5 6H9.5" stroke="#3B5998" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </div>

                    <div class="attach-menu" id="attachMenu">
                        <div class="menu-option-wrap">
                        <div class="menu-option">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="14" viewBox="0 0 12 14" fill="none">
                                <path d="M8.06132 4.15981L7.23549 3.33398L3.10382 7.46398C2.94109 7.62671 2.81201 7.8199 2.72394 8.03251C2.63587 8.24513 2.59054 8.47301 2.59054 8.70315C2.59054 8.93328 2.63587 9.16116 2.72394 9.37378C2.81201 9.58639 2.94109 9.77958 3.10382 9.94231C3.26655 10.105 3.45974 10.2341 3.67235 10.3222C3.88497 10.4103 4.11285 10.4556 4.34299 10.4556C4.57312 10.4556 4.801 10.4103 5.01362 10.3222C5.22623 10.2341 5.41942 10.105 5.58215 9.94231L10.5397 4.98565C11.0873 4.43786 11.395 3.69495 11.3949 2.92035C11.3948 2.14575 11.087 1.4029 10.5392 0.855229C9.99145 0.307557 9.24854 -7.81253e-05 8.47394 1.48822e-08C7.69934 7.8155e-05 6.95649 0.307863 6.40882 0.855646L1.20382 6.05981L1.19299 6.07065C0.429052 6.83469 -7.81295e-05 7.87091 1.06695e-08 8.95136C7.81508e-05 10.0318 0.429358 11.068 1.1934 11.8319C1.95745 12.5958 2.99367 13.025 4.07411 13.0249C5.15456 13.0248 6.19072 12.5955 6.95465 11.8315L6.96549 11.8206L10.518 8.26815L9.69132 7.44231L6.13715 10.9948L6.12632 11.0056C5.58097 11.5503 4.84158 11.8561 4.0708 11.8556C3.30003 11.8551 2.56101 11.5485 2.01632 11.0031C1.47163 10.4578 1.16589 9.7184 1.16636 8.94763C1.16683 8.17685 1.47347 7.43783 2.01882 6.89315L2.03049 6.88231L7.23632 1.67815C7.56541 1.34961 8.01153 1.16526 8.47654 1.16565C8.94155 1.16604 9.38736 1.35114 9.7159 1.68023C10.0444 2.00932 10.2288 2.45544 10.2284 2.92045C10.228 3.38546 10.0429 3.83128 9.71382 4.15981L4.75632 9.11648C4.64681 9.2261 4.49823 9.28773 4.34328 9.28781C4.18833 9.28789 4.03969 9.22641 3.93007 9.11689C3.82045 9.00738 3.75882 8.85881 3.75874 8.70386C3.75866 8.5489 3.82014 8.40027 3.92965 8.29064L8.06132 4.15981Z" fill="#707070"></path>
                            </svg>
                            <span>Attach photo or files</span>
                        </div>
                        
                        <div class="menu-option">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M11.0719 4.79883C11.3199 4.79882 11.5633 4.86592 11.7763 4.993C11.9894 5.12009 12.164 5.30243 12.2819 5.5207L12.616 6.13945C12.7338 6.35773 12.9085 6.54007 13.1215 6.66715C13.3345 6.79424 13.5779 6.86133 13.826 6.86133H15.1989C15.5636 6.86133 15.9133 7.00619 16.1712 7.26406C16.429 7.52192 16.5739 7.87166 16.5739 8.23633V14.4238C16.5739 14.7885 16.429 15.1382 16.1712 15.3961C15.9133 15.654 15.5636 15.7988 15.1989 15.7988H4.19891C3.83424 15.7988 3.4845 15.654 3.22664 15.3961C2.96878 15.1382 2.82391 14.7885 2.82391 14.4238V8.23633C2.82391 7.87166 2.96878 7.52192 3.22664 7.26406C3.4845 7.00619 3.83424 6.86133 4.19891 6.86133H5.57185C5.81964 6.86134 6.06283 6.7944 6.2757 6.66757C6.48857 6.54074 6.66322 6.35875 6.78116 6.14083L7.11735 5.51933C7.2353 5.30141 7.40994 5.11942 7.62281 4.99259C7.83569 4.86576 8.07887 4.79881 8.32666 4.79883H11.0719Z" stroke="#707070" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"></path>
                                <path d="M9.69879 13.0488C10.8379 13.0488 11.7613 12.1254 11.7613 10.9863C11.7613 9.84724 10.8379 8.92383 9.69879 8.92383C8.5597 8.92383 7.63629 9.84724 7.63629 10.9863C7.63629 12.1254 8.5597 13.0488 9.69879 13.0488Z" stroke="#707070" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            <span>Take a screenshot</span>
                        </div>
                        </div>

                        <div class="tip-box">
                            <span class="tip-title">Tip:</span>
                            <span class="tip-text">Paste notes or links directly to auto-create your KB.</span>
                        </div>
                    </div>
                </div>
                <button class="submit-btn" >
                    <span class="next-bt" id="promptBtn">Next</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="10" viewBox="0 0 14 10" fill="none">
                        <path d="M0.649902 5.43656C0.290917 5.43656 -9.76324e-05 5.14555 -9.76324e-05 4.78656C-9.76324e-05 4.42757 0.290917 4.13656 0.649902 4.13656L0.649902 4.78656L0.649902 5.43656ZM13.1095 4.32694C13.3634 4.58078 13.3634 4.99234 13.1095 5.24618L8.97295 9.38275C8.71911 9.63659 8.30755 9.63659 8.05371 9.38275C7.79987 9.12891 7.79987 8.71736 8.05371 8.46352L11.7307 4.78656L8.05371 1.1096C7.79987 0.855764 7.79987 0.444207 8.05371 0.190366C8.30755 -0.0634747 8.71911 -0.0634747 8.97295 0.190366L13.1095 4.32694ZM0.649902 4.78656L0.649902 4.13656L12.6499 4.13656V4.78656V5.43656L0.649902 5.43656L0.649902 4.78656Z" fill="white"></path>
                    </svg>
                    
                </button>
            </div>
        </div>
    </div>
    <div class="btm-tip-wrap"> <span>Tip</span>: Be specific about your knowledge base. Mention the product, topic, or audience. You can also upload documents or files you‚Äôd like to include.</div>
</div>

  <script>
    const form = document.getElementById("scrapeForm");
    const analyzeBtn = form.querySelector("button[type='submit']");
    const resDiv = document.getElementById("result");
    const modal = document.getElementById("loadingModal");
    const steps = document.querySelectorAll(".step");
    const finalScreen = document.getElementById("finalScreen");
    const promptWindow = document.getElementById("promptWindow");

    let current = 0, stepTimer;
    let currentSessionId = null;
    let scrapeData = null;
    let convertedText = null;

    function showModal() {
      modal.style.display = "flex";
      current = 0;
      steps.forEach(s => s.classList.remove("active", "done"));
      stepTimer = setInterval(() => {
        if (current < steps.length) {
          steps[current].classList.add("active");
          setTimeout(() => steps[current].classList.add("done"), 500);
          current++;
        } else {
          clearInterval(stepTimer);
        }
      }, 1300);
    }

    function hideModal() {
      modal.style.display = "none";
      clearInterval(stepTimer);
    }

    function showFinalScreen() {
      finalScreen.style.display = "flex";
      promptWindow.style.display = "none";
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const domain = document.getElementById("domain").value;
      analyzeBtn.disabled = true;
      showModal();

      try {
        const formData = new FormData();
        formData.append('domain', domain);

        const res = await fetch("http://devmaster8.kblive.com/brand/scrape", {
          method: "POST",
          body: formData
        });

        const response = await res.json();
        hideModal();

        if (response.success) {
          if (response.data && response.data.sessionId) {
            currentSessionId = response.data.sessionId;
            scrapeData = response.data;
            localStorage.setItem("scraped_data", JSON.stringify(scrapeData));
            localStorage.setItem("session_id", currentSessionId);
          }
          showFinalScreen(); 
        } else {
          resDiv.innerHTML = `<p style="color:red;">‚ùå ${response.error || 'Unknown error'}</p>`;
        }
      } catch (error) {
        hideModal();
        resDiv.innerHTML = `<p style="color:red;">‚ùå Error: ${error.message}</p>`;
      } finally {
        analyzeBtn.disabled = false;
        analyzeBtn.textContent = "Analyze";
      }
    });

    // Frame 0013 interactivity
    const publicOption = document.getElementById("publicOption");
    const privateOption = document.getElementById("privateOption");
    const saveBtn = document.getElementById("saveBtn");

    publicOption.addEventListener("click", () => {
      publicOption.classList.add("selected");
      privateOption.classList.remove("selected");
    });

    privateOption.addEventListener("click", () => {
      privateOption.classList.add("selected");
      publicOption.classList.remove("selected");
    });

    saveBtn.addEventListener("click", async () => {
      const sessionId = localStorage.getItem("session_id");
      if (!sessionId) {
        console.log("‚ùå Error: No session ID available. Please run the analysis again.");
        return;
      }

      const visibility = publicOption.classList.contains("selected") ? "0" : "1";
      const saveBtnOriginalText = saveBtn.textContent;
      saveBtn.disabled = true;
      saveBtn.textContent = "Saving...";
      
        try {
            const requestBody = {
              session_id: sessionId,
              is_public: visibility
            };
          
            const res = await fetch("http://devmaster8.kblive.com/brand/update", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(requestBody)
            });

            if (!res.ok) {
              const text = await res.text();
              throw new Error(`HTTP ${res.status}: ${text}`);
            }
            const response = await res.json();
          
            if (response.status) {
              finalScreen.style.display = "none";
              promptWindow.style.display = "block";
              form.style.display = "none";
            } else {
              throw new Error(response.message || "Failed to save settings");
            }
        } catch (err) {
          let errorMessage = err.message;
          
          if (err.name === "TypeError" && err.message === "Failed to fetch") {
            errorMessage = "Network error: Could not connect to server. Please check your connection and try again.";
          }
        } finally {
          saveBtn.disabled = false;
          saveBtn.textContent = saveBtnOriginalText;
        }
    });

    const promptButton = document.querySelector(".submit-btn");
    promptButton.addEventListener("click", async () => {
      if (promptButton.classList.contains("disabled")) return;

      const scrapedData = JSON.parse(localStorage.getItem("scraped_data") || "{}");
      const sessionId = localStorage.getItem("session_id");
      const prompt = document.getElementById("courseInput").value;
      
      let requestBody = {
        user_prompt: prompt,
        scraped_data: scrapedData,
        session_id: sessionId
      }
      if(convertedText){
        requestBody.converted_text = convertedText;
      }
      console.log(requestBody);
      try {
        const res = await fetch("http://devmaster8.kblive.com/brand/generate_structure", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(requestBody)
        });
        const data = await res.json();
        if(!data.status){
          console.log("‚ùå AI generation error:", data.message);
        }
      } catch (err) {
        console.log("‚ùå AI generation error:", err.message);
      }
    });

    // file attachment code 
    const attachBtn = document.getElementById("attachBtn");
    const attachMenu = document.getElementById("attachMenu");
    const fileDetails = document.getElementById("filedetails");

    attachBtn.addEventListener("click", () => {
      attachMenu.style.opacity = attachMenu.style.opacity === "1" ? "0" : "1";
      attachMenu.style.visibility = attachMenu.style.visibility === "visible" ? "hidden" : "visible";
    });

    const fileInput = document.createElement("input");
    fileInput.type = "file";
    fileInput.accept = ".pdf,.doc,.docx";
    fileInput.style.display = "none";
    document.body.appendChild(fileInput);

    attachMenu.querySelector(".menu-option span").addEventListener("click", () => {
      fileInput.click();
    });

    fileInput.addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const maxSize = 10 * 1024 * 1024; // 10MB
      if (file.size > maxSize) {
        alert("‚ùå File too large! Max 10 MB allowed.");
        return;
      }

      const validTypes = ["application/pdf", 
                          "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                          "application/msword"];
      if (!validTypes.includes(file.type)) {
        alert("‚ùå Invalid file type! Only PDF or DOCX allowed.");
        return;
      }

      fileDetails.style.display = "block";
      fileDetails.textContent = `üìé Attached: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;

      const formData = new FormData();
      formData.append("file", file);

      try {
        const res = await fetch("http://devmaster8.kblive.com/brand/convert_attachment", {
          method: "POST",
          body: formData,
        });

        const data = await res.json();
        convertedText = data.text;
        if (!res.ok || !data.status) {
          throw new Error(data.error || "Upload failed");
        }
      } catch (err) {
        console.error("Upload error:", err);
      }
    });
  </script>
</body>
</html>
